name: Summarize and Post Changelog

on:
  issue_comment:
    types: [created]
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

permissions:
  contents: read
  discussions: write
  pull-requests: write
  issues: write

jobs:
  summarize:
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'workflow_dispatch' ||
      (
        github.event_name == 'issue_comment' &&
        contains(github.event.comment.body, 'Changelogã‚’è¦ç´„ã—ã¦ãã ã•ã„') &&
        github.event.comment.user.login == 'github-actions[bot]'
      )

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Setup Deno
        uses: denoland/setup-deno@v2
        with:
          deno-version: v2.x

      - name: Summarize with Claude Code
        uses: anthropics/claude-code-action@v1
        with:
          prompt: |
            Issue #1 (https://github.com/korosuke613/mynewshq/issues/1) ã®æœ€æ–°ã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã€
            Changelog JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã€æ—¥æœ¬èªã§è¦ç´„ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

            ã‚³ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã®å½¢å¼ã«ãªã£ã¦ã„ã¾ã™ï¼š
            ```
            ğŸ“° YYYY-MM-DDã®Changelogã‚’è¦ç´„ã—ã¦ãã ã•ã„ã€‚

            <details>
            <summary>Changelog Data</summary>

            ```json
            { ... JSONãƒ‡ãƒ¼ã‚¿ ... }
            ```

            </details>
            ```

            è¦ç´„ã®ãƒ«ãƒ¼ãƒ«ï¼š
            1. GitHub Changelogã€AWS What's Newã€Claude Codeã®3ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ†ã‘ã‚‹
            2. å„ã‚¨ãƒ³ãƒˆãƒªã«ã¤ã„ã¦ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨URLã‚’ãƒªãƒ³ã‚¯å½¢å¼ã§è¡¨ç¤º
            3. å†…å®¹ã‚’2-3æ–‡ã§ç°¡æ½”ã«æ—¥æœ¬èªã§è¦ç´„
            4. æŠ€è¡“è€…å‘ã‘ã«ã‚ã‹ã‚Šã‚„ã™ãã€é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’å¼·èª¿

            è¦ç´„ãŒå®Œæˆã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦Discussionã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ï¼š
            ```bash
            deno task post korosuke613 mynewshq General "$(cat summary.md)"
            ```

            summary.mdã«ã¯ç”Ÿæˆã—ãŸè¦ç´„ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
