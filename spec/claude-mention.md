# @claude メンション機能仕様書

## 1. 概要

### 目的

@claude メンション機能は、GitHub Discussions のコメントで `@claude` をメンションすることで、Claude Code Action に質問を投げかけ、自動で回答を生成・投稿する機能です。

### 特徴

- **対話的な情報取得**: Discussion内で直接Claudeに質問可能
- **コンテキスト認識**: リポジトリ内のデータを参照した回答
- **アクセス制限**: 許可されたユーザーのみが利用可能

---

## 2. トリガー条件

### 発火条件

以下の両方を満たす場合に機能が発火します：

1. Discussion コメントに `@claude` が含まれている
2. コメント投稿者が許可ユーザーである

### 許可ユーザー

現在は `korosuke613` のみが @claude メンションを使用できます。

---

## 3. 2段階ワークフロー構成

### なぜ2段階なのか

GitHub Actions の制限により、`discussion_comment` イベントでは直接 Claude Code Action を実行できません。そのため、以下の2段階構成を採用しています：

1. **Trigger ワークフロー**: コメントを検知し、Answer ワークフローを起動
2. **Answer ワークフロー**: Claude Code Action で回答を生成・投稿

### 処理フロー

```
Discussion Comment
"@claude この機能について教えて"
        ↓
Trigger ワークフロー
- @claude メンションを検知
- 許可ユーザーかチェック
- 質問内容をパース
- Answer ワークフローを起動
        ↓
Answer ワークフロー
- Claude Code Action で回答生成
- Discussion にコメント投稿
        ↓
Discussion Reply
"回答内容..."
*この回答は Claude Code Action によって生成されました*
```

---

## 4. 質問のパース

`@claude` を除去した残りの部分が質問として抽出されます。

- 前後の空白は削除
- 複数行は単一行に変換

---

## 5. 利用可能ツール

Claude Code Action は以下のツールのみ使用可能です：

| ツール | 説明 |
|--------|------|
| `Read` | リポジトリ内のファイル読み取り |
| `WebFetch` | 外部URLからのコンテンツ取得 |
| `WebSearch` | Web検索 |

書き込み系ツール（`Write`, `Edit`, `Bash` 等）は許可されていません。

---

## 6. 回答の投稿先

| 条件 | 投稿方法 |
|------|---------|
| 元コメントあり | 元コメントへのリプライとして投稿 |
| 元コメントなし | Discussionへの新規コメントとして投稿 |

---

## 7. 回答の形式

回答の末尾には以下が自動的に追加されます：

```markdown
---
*この回答は Claude Code Action によって生成されました*
[ワークフロー実行ログ](URL)
```

### 回答例

```markdown
## 質問への回答

この質問に対する回答です。

### 詳細

- ポイント1
- ポイント2
- ポイント3

最新の `data/changelogs/daily/2026-01-27.json` を確認したところ、
該当する更新は見つかりませんでした。

---
*この回答は Claude Code Action によって生成されました*
[ワークフロー実行ログ](https://github.com/korosuke613/mynewshq/actions/runs/12345)
```

---

## 8. セキュリティ考慮事項

### アクセス制限

- 許可ユーザーリストによるアクセス制御
- GitHub App トークンを使用した認証

### ツール制限

書き込み系ツールは許可されていないため、リポジトリの内容を変更することはできません。

---

## 9. 使用例

### 基本的な質問

```
@claude 最新のGitHub Changelogで注目すべき更新はありますか？
```

### データ分析の依頼

```
@claude 今週のAWS What's Newで最も多く更新されたサービスは何ですか？
```

### システムについての質問

```
@claude このリポジトリのデータ取得の仕組みを教えてください。
```
